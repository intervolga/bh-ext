"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var BhExt=require("bh/lib/bh");BhExt.prototype.cbc=function(t,s){this._replacements||(this._replacements={}),t&&(this._replacements[t]=s)},BhExt.prototype.replaceBemCssClasses=function(t){var s=this;return t&&s._replacements?t.split(" ").map(function(t){return s._replacements.hasOwnProperty(t)?s._replacements[t]:t}).filter(function(t){return 0<t.length}).join(" ").trim():t};var xmlEscape=BhExt.prototype.xmlEscape,attrEscape=BhExt.prototype.attrEscape,jsAttrEscape=BhExt.prototype.jsAttrEscape,toBemCssClasses=function(t,s,e,o,r){var i,l,a,p="";if(e!==s&&(e&&(p+=" "),p+=s),i=t.elem&&t.elemMods||t.mods)for(a in i)i.hasOwnProperty(a)&&(!(l=i[a])&&0!==l||(p+=" "+(o?r:s+r)+a+(!0===l?"":r+l)));return p};BhExt.prototype._html=function(t){var s,e,o;if(!1!==t&&null!=t)if("object"!==_typeof(t))this._buf+=this._optEscapeContent?xmlEscape(t):t;else if(Array.isArray(t))for(s=0,e=t.length;s<e;s++)!1!==(o=t[s])&&null!=o&&this._html(o);else{if(t.toHtml){var r=t.toHtml.call(this,t)||"";return void(this._buf+=r)}var i=!1!==t.bem;if(void 0!==t.tag&&!t.tag)return void(t.html?this._buf+=t.html:this._html(t.content));t.mix&&!Array.isArray(t.mix)&&(t.mix=[t.mix]);var l,a,p,n="",h="",m=!1;if(l=t.attrs)for(s in l)!0===(a=l[s])?h+=" "+s:!1!==a&&null!=a&&(h+=" "+s+'="'+attrEscape(a)+'"');if(i){var c=t.block+(t.elem?this._optDelimElem+t.elem:"");t.block&&(n=toBemCssClasses(t,c,null,this._optNobaseMods,this._optDelimMod),t.js&&((p={})[c]=!0===t.js?{}:t.js));var f=this._optJsCls&&(this._optJsElem||!t.elem),u=t.mix;if(u&&u.length)for(s=0,e=u.length;s<e;s++){var _=u[s];if(_&&!1!==_.bem){var b=_.block||t.block||"",y=_.elem||(_.block?null:t.block&&t.elem),E=b+(y?this._optDelimElem+y:"");b&&(n+=toBemCssClasses(_,E,c,this._optNobaseMods,this._optDelimMod),_.js&&((p=p||{})[E]=!0===_.js?{}:_.js,m=!0,f=f||b&&this._optJsCls&&(this._optJsElem||!y)))}}if(p){f&&(n+=" "+this._optJsCls);var v=m||!0!==t.js?jsAttrEscape(JSON.stringify(p)):'{"'+c+'":{}}';h+=" "+(t.jsAttr||this._optJsAttrName)+"='"+(this._optJsAttrIsJs?"return "+v:v)+"'"}}t.cls&&(n=(n?n+" ":"")+attrEscape(t.cls).trim()),n=this.replaceBemCssClasses(n);var x=t.tag||"div";this._buf+="<"+x+(n?' class="'+n+'"':"")+(h||""),this._shortTags[x]?this._buf+=this._optShortTagCloser:(this._buf+=">",t.html?this._buf+=t.html:this._html(t.content),this._buf+="</"+x+">")}},module.exports=BhExt;